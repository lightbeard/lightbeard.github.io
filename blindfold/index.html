<!DOCTYPE html>
<html>
<head>
<title>blindfold</title>

<script
  src="https://code.jquery.com/jquery-2.2.4.min.js"
  integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
  crossorigin="anonymous"></script>

<script src="chess.min.js"></script>

  <style>
    * {
      font-family: monospace;
    }

    .highlight {
      background-color: cyan;
    }

  </style>

</head>
<br>
FEN:&nbsp;
<input id="fen" type="text" size="50" value="4rk1/8/8/8/8/8/8/4K3 w - - 0 50">&nbsp;&nbsp;<button id="update">update</button><br>
<br>
<button class="btn">a</button>
<button class="btn">b</button>
<button class="btn">c</button>
<button class="btn">d</button>
<button class="btn">e</button>
<button class="btn">f</button>
<button class="btn">g</button>
<button class="btn">h</button>
<br><br>
<button class="btn">1</button>
<button class="btn">2</button>
<button class="btn">3</button>
<button class="btn">4</button>
<button class="btn">5</button>
<button class="btn">6</button>
<button class="btn">7</button>
<button class="btn">8</button>
<br><br>
<button class="btn">N</button>
<button class="btn">B</button>
<button class="btn">R</button>
<button class="btn">Q</button>
<button class="btn">K</button>


<script>

  var stockfish = new Worker("stockfish.js");
  stockfish.postMessage("position fen " + $('#fen').val());

  stockfish.onmessage = function(event) {
      //NOTE: Web Workers wrap the response in an object.
      console.log(event.data ? event.data : event);
  };

  var chess = new Chess($('#fen').val());

  $('.btn').click(function(e) {
    var $btn = $(e.target);
    var $previous = $('.highlight');

    $btn.addClass('highlight');

    if($previous.length === 2 || $previous.length === 1 && !/N|B|R|Q|K/.test($previous.html())) {
      // last char of san

      $('.highlight').removeClass('highlight');

      var san;

      if($previous.length == 1) {
        san = $previous.html() + $btn.html();
      } else if(/N|B|R|Q|K/.test($($previous[0]).html())) {
        san = $($previous[0]).html() + $($previous[1]).html() + $btn.html();
      } else {
        san = $($previous[1]).html() + $($previous[0]).html() + $btn.html();
      }

      var ok = chess.move(san);
      if(!ok) {
        console.log(chess.ascii());
        alert('invalid san: ' + san);
      } else {
        var h = chess.history({ verbose: true });
        h = h[h.length - 1];

        stockfish.postMessage('position moves ' + h.from + h.to);
      }
    }
  });
</script>

<body>
