<!DOCTYPE html>
<html>
<head>
<title>blindfold</title>

<script
  src="https://code.jquery.com/jquery-2.2.4.min.js"
  integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
  crossorigin="anonymous"></script>

<script src="chess.min.js"></script>

  <style>
    * {
      font-family: monospace;
      font-size: 4.5vw;
    }

    .highlight {
      background-color: cyan;
    }
    
    button {
      padding: 0.5em 0.7em;
    }

  </style>

</head>
<p id="san"></p>
FEN:&nbsp;
<input id="fen" type="text" size="50" value="5rk1/8/8/8/8/8/8/4K3 w - - 0 50">
  <br><br>
  <button id="update">update</button>&nbsp;&nbsp;
  <button id="peek">peek</button>&nbsp;&nbsp;
  <button id="pass">pass</button>
  <select id="score">
    <option value="0">0cp</option>
    <option value="1">100cp</option>
    <option value="2">200cp</option>
    <option value="3" selected="selected">300cp</option>
  </select>
  <select id="pieceCnt">
    <option value="any" selected="selected">any</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
  </select>
  
<br><br>
<button class="btn">a</button>
<button class="btn">b</button>
<button class="btn">c</button>
<button class="btn">d</button>
<button class="btn">e</button>
<button class="btn">f</button>
<button class="btn">g</button>
<button class="btn">h</button>
<br><br>
<button class="btn">1</button>
<button class="btn">2</button>
<button class="btn">3</button>
<button class="btn">4</button>
<button class="btn">5</button>
<button class="btn">6</button>
<button class="btn">7</button>
<button class="btn">8</button>
<br><br>
<button class="btn">N</button>
<button class="btn">B</button>
<button class="btn">R</button>
<button class="btn">Q</button>
<button class="btn">K</button>
<button class="btn">x</button>


<script>
  
  var select = '';
  
  var cache = localStorage.getItem('fen');
  if(cache) $('#fen').val(cache);

  var chess = new Chess($('#fen').val());
  
  var stockfish = new Worker("stockfish.js");
  stockfish.postMessage("position fen " + $('#fen').val());

  stockfish.onmessage = function(event) {
      if(event.data.indexOf('mate') >= 0) {
        $('#san').html('mate');
      } else if(event.data.indexOf('bestmove') >= 0) {
        var move = /bestmove\s(\w\d)(\w\d)/.exec(event.data);
        var ok = chess.move({from:move[1], to:move[2]});
        
        var san = chess.history()[chess.history().length - 1];
        $('#san').html(san);
      }
  };
  
  $('#update').click(function(e) {
    var fen = $('#fen').val();
    if(chess.validate_fen(fen).valid) {
      localStorage.setItem('fen', fen);
      chess = new Chess(fen);
    } else {
      alert('invalid fen');
    }
  });
  
  $('#peek').click(function() {
    alert(chess.ascii());
  });
  
  $('#pass').click(function() {
     stockfish.postMessage('position fen ' + chess.fen());
     stockfish.postMessage('go depth 8');
  });
  
  $('.btn').click(function(e) {
    var $btn = $(e.target);
    var char = $btn.html();
    var $previous = $('.highlight');

    select += char;
    
    $btn.addClass('highlight');

    if(/\d/.test(char)) {
      
      $('.highlight').removeClass('highlight');
      
      var ok = chess.move(select, {'sloppy':true});
      if(!ok) {
        alert('invalid san: ' + select + '\n' + chess.ascii());
      } else {
        stockfish.postMessage('position fen ' + chess.fen());
        stockfish.postMessage('go depth 8');
      }
      
      select = '';
    }
  });
  
  var fens = {"3":{"0":["8/8/8/Pk6/8/8/K7/8 b - - 0 78","8/8/8/Pk6/8/8/K7/8 b - - 0 78"],"1":[],"2":[],"3":[]},"4":{"0":["8/8/8/Pk6/8/K7/n7/8 w - - 0 78","8/8/8/Pk6/8/K7/n7/8 w - - 0 78"],"1":["K7/8/4p3/8/5k2/1P6/8/8 b - - 0 71"],"2":["8/B7/1Pk5/6K1/8/8/8/8 b - - 2 68","8/Bk6/1P6/6K1/8/8/8/8 w - - 3 69"],"3":["8/B2k4/1P6/7K/8/8/8/8 b - - 0 67"]},"5":{"0":["8/8/8/Pk6/8/K7/B7/2n5 b - - 0 77","5R2/8/6k1/8/8/r3K3/4P3/8 w - - 8 61"],"1":["8/8/8/4k1KR/7P/8/8/5r2 w - - 0 63","8/8/4k1K1/7R/7P/8/8/5r2 w - - 2 64"],"2":["5k1K/8/8/6RP/8/8/8/5r2 w - - 5 68","8/8/1RK2p2/7p/5k2/8/8/8 w - - 0 65"],"3":["8/8/8/5PkP/8/5B2/6K1/8 b - - 0 116","8/8/4k3/R3b3/P7/8/4K3/8 b - - 0 69"]},"6":{"0":["8/8/8/pk6/1P6/K7/B7/2n5 w - - 0 77","8/8/8/pk6/1P6/K7/B7/2n5 w - - 0 77"],"1":["8/6b1/2R5/8/3p4/1K2k3/4P3/8 w - - 1 111","8/6b1/6R1/8/3p4/1K2k3/4P3/8 b - - 2 111"],"2":["8/8/p7/bk1p4/8/3KB3/8/8 b - - 0 50","8/8/pb6/1k1p4/8/3KB3/8/8 w - - 1 51"],"3":["8/8/1b6/1k6/p2p4/2K5/1B6/8 w - - 0 54","8/8/5k2/p3b3/P1R5/8/4K3/8 w - - 7 68"]},"7":{"0":["8/8/2k5/pR6/1P6/K7/B7/2n5 b - - 0 76","8/8/8/6k1/3p1R2/6P1/3KP3/6r1 w - - 4 54"],"1":["8/8/5k2/q6P/4R1P1/5B2/6K1/8 w - - 5 114","8/5p2/R1p5/2r1k3/1P6/8/6K1/8 b - b3 0 44"],"2":["8/5K2/1r2R3/5k1P/6p1/8/4p3/8 w - - 0 57","8/8/8/4k1Pp/1p5K/1N6/p7/8 b - - 1 60"],"3":["8/8/8/4k1Pp/1p5K/1N6/p7/8 b - - 1 60","6R1/8/3pk3/4r2b/3K3P/8/8/8 b - - 6 57"]},"8":{"0":["8/8/2k5/pR6/1PB5/K7/r7/2n5 w - - 0 76","8/6k1/1p2N1p1/8/6PP/p7/7K/8 b - - 0 52"],"1":["8/8/8/1p5r/6R1/1P4B1/n7/5K1k b - - 1 56","8/8/6k1/6P1/1r1p3R/6P1/4PK2/8 w - - 0 48"],"2":["8/2R2pk1/7p/3b4/2p5/1p2K3/8/8 w - - 0 56","8/2R2pk1/7p/3b4/2p5/1p6/3K4/8 b - - 1 56"],"3":["8/2R2pk1/4b2p/8/2p5/1p6/3K4/8 w - - 2 57","8/5K2/1P5R/4k2P/6p1/8/1r2p3/8 b - - 0 55"]},"9":{"0":["8/8/8/pKr3k1/1b1NR2p/8/6P1/8 w - - 12 94","8/8/8/p1r3k1/Kb1NR2p/8/6P1/8 b - - 13 94"],"1":["5k2/8/7R/p1r4n/8/1P6/P1B5/1K6 w - - 1 55","5k2/8/7R/p1r4n/8/1P1B4/P7/1K6 b - - 2 55"],"2":["5k2/5P2/p7/4Rb2/2p5/1P4KP/8/8 b - - 0 52","5k2/5P2/p7/4R3/2p5/1P1b2KP/8/8 w - - 1 53"],"3":["5k2/5P2/p7/2R5/1P6/2pb2KP/8/8 b - - 1 54","5k2/5P2/p7/2R5/1P6/3b2KP/2p5/8 w - - 0 55"]},"10":{"0":["8/3k4/8/p2Nb1R1/P1K4p/8/3r2P1/8 b - - 0 58","8/8/4k3/p2Nb1R1/P1K4p/8/3r2P1/8 w - - 1 59"],"1":["8/8/7R/1p1r4/7p/3n3k/PP2K3/4B3 w - - 0 49","8/5p2/5R2/3p2Pp/1r1k4/6P1/4PK2/8 w - - 0 44"],"2":["5k2/5P2/p7/3Rrb2/2p5/1P4KP/8/8 w - - 0 52","8/8/8/1R2Pppk/3P1n1p/8/5P2/7K b - - 0 48"],"3":["8/3nkp2/2R4p/2p5/5Kb1/1p6/8/3N4 w - - 0 49","2R5/3nkp2/4b2p/2p5/5K2/1pN5/8/8 b - - 3 50"]},"11":{"0":["8/3k4/6R1/p2Nb1p1/P1K4p/8/3r2P1/8 w - - 0 58","8/8/1r5p/3kp1p1/1P4P1/1R2P3/4P1K1/8 b - - 0 43"],"1":["8/8/7R/1p1r4/6kp/8/PP1BKn1P/8 w - - 2 47","8/8/7R/1p1r4/6kp/8/PP2Kn1P/4B3 b - - 3 47"],"2":["5k2/5P2/p7/3RNb2/2p1r3/1P4KP/8/8 b - - 1 51","8/8/8/1nR1Pppk/3P1n1p/8/5P2/7K w - - 0 48"],"3":["8/3k1q2/p5pP/1pQ5/5P2/8/PPK5/8 b - - 0 41","5K2/2p3p1/4kp1p/1PR5/4p2P/8/5r2/8 w - - 0 49"]},"12":{"0":["7r/8/3k4/p1b3p1/P3P1Np/3K4/6P1/2R5 b - - 0 45","7r/8/3k4/p5p1/Pb2P1Np/3K4/6P1/2R5 w - - 1 46"],"1":["8/2bk4/6R1/p2K2p1/P3P2p/4N3/5rP1/8 b - - 18 54","5k2/5P2/p7/1pR1Nb2/2P1r3/1P4KP/8/8 b - - 0 50"],"2":["8/8/8/1PR1Pppk/3P1n1p/n7/5P2/7K b - - 0 47","8/1rp2pp1/3k3p/1P3R2/4p2P/6K1/5P2/8 b - - 3 42"],"3":["4q3/6Q1/p3k1pP/1pp5/5P2/8/PPK5/8 b - - 2 39","8/5qQ1/p3k1pP/1pp5/5P2/8/PPK5/8 w - - 3 40"]},"13":{"0":["7r/8/3k4/p1b3p1/P3p1Np/3K1P2/6P1/2R5 w - - 0 45","2r3k1/8/1R1n1bp1/7p/4P3/4B3/4B1PP/6K1 b - - 0 33"],"1":["5k2/2R2P2/pp1r1N2/2p2b2/2P5/6KP/1P6/8 w - - 3 47","5k2/2R2P2/pp1r4/2p2b2/2P3N1/6KP/1P6/8 b - - 4 47"],"2":["8/5p2/5R2/3p2pp/1P1Pk3/1r4P1/4PK1P/8 w - - 7 42","6k1/3n1pp1/7p/1ppb3P/6P1/7K/2N5/4R3 w - - 0 40"],"3":["6k1/4pp2/q5p1/2pPP1Q1/p7/8/5PP1/6K1 b - - 0 35","6k1/4pp2/q2P2p1/2p1P1Q1/8/p7/5PP1/6K1 b - - 0 36"]},"14":{"0":["7r/8/3k4/p1bp2p1/P3P1Np/3K1P2/6P1/2R5 b - - 0 44","2r3k1/8/Rp1n1bp1/7p/4P3/4B3/4B1PP/6K1 w - - 1 33"],"1":["8/7k/1n2r1p1/4Pp2/1PnP3p/8/5PK1/R1R5 w - - 2 40","8/2R5/1n2r1pk/4Pp2/1P1P3p/n7/5PK1/2R5 w - - 6 42"],"2":["6k1/1b1n1pp1/7p/1ppQ3P/6P1/7K/2N5/4R3 b - - 0 39","8/1rp1kpp1/7p/2Rpr3/1P1R3P/8/5P1K/8 w - - 3 39"],"3":["2q3k1/5P1p/p5pP/1pp1Q3/5P2/8/PPK5/8 b - - 0 36","6k1/4pp2/3q2p1/2pn2Q1/p1P1P3/8/5PP1/6K1 w - - 0 34"]},"15":{"0":["3r4/p4ppp/4k3/4p3/8/4P1P1/PP2P2P/R4K2 b - - 0 21","8/p4ppp/4k3/4p3/8/4P1P1/PP1rP2P/R4K2 w - - 1 22"],"1":["8/p4ppp/1r6/4p3/4k3/1P2P1P1/P3P2P/2RK4 w - - 1 27","7r/R7/1p1bk3/2p3p1/7p/2PN3P/1P3PP1/5K2 b - - 1 31"],"2":["6k1/1b1n1pp1/7p/1pp2q1P/8/6PK/2N5/3QR3 w - - 0 38","6k1/1b1n1pp1/7p/1pp2q1P/6P1/7K/2N5/3QR3 b - - 0 38"],"3":["6k1/4pp2/3q1np1/2pN2Q1/p3P3/2P5/5PP1/6K1 w - - 1 33","4R3/p1p2pp1/1b2k1r1/6p1/8/6PP/P2R1PK1/8 b - - 10 30"]},"16":{"0":["7r/1p6/8/p1bp1kp1/P5Np/3KPP2/1P4P1/5R2 w - - 0 39","7r/1p6/8/p1bp1kp1/P5Np/3KPP2/1P4P1/2R5 b - - 1 39"],"1":["2r5/7k/Bn2r1p1/4Pp2/1PnP3p/8/5PK1/R2R4 w - - 0 38","7k/6r1/1q2p2p/p4n1P/2r5/1B2P3/PP3Q2/K2R4 w - - 0 44"],"2":["2q3k1/3r3p/p3PPpP/1pp1Q3/5P2/8/PPK5/8 w - - 1 35","2q3k1/3r1P1p/p3P1pP/1pp1Q3/5P2/8/PPK5/8 b - - 0 35"],"3":["1Q2R3/2p2r1k/1n4p1/1P1qp2p/8/2P2P2/5NP1/6K1 b - - 1 53","4R3/Q1p2r1k/1n4p1/1P1qp2p/8/2P2P2/5NP1/6K1 w - - 0 53"]}};
  
  $('#pieceCnt, #score').on('change', function(e) {
    var pieceCnt = $(e.target).val();
    var score = $('#score').val();
    
    if(pieceCnt === 'any') pieceCnt = Math.floor(Math.random() * 14) + 3;
    
    console.log(String(pieceCnt), score, fens);
    
    var section = fens[String(pieceCnt)][score];
    
    var index = Math.floor(Math.random() * section.length);
    $('#fen').html(section[index]);
  });
  
</script>

<body>
